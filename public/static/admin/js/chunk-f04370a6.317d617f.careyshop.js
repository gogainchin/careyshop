(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f04370a6"],{"388b":function(e,t,a){"use strict";a("b6fb")},b6fb:function(e,t,a){},ed86:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cs-p"},[a("el-tabs",{staticClass:"tab-box",on:{"tab-click":function(t){e.$emit("tabs",t.name)}},model:{value:e.tabPane,callback:function(t){e.tabPane=t},expression:"tabPane"}},e._l(e.statusMap,(function(t,n){return a("el-tab-pane",{key:n,attrs:{name:n,label:t.text}},[n===e.tabPane?a("el-table",{attrs:{data:e.currentTableData},on:{"sort-change":e.sortChange}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"发票抬头"}},[a("span",[e._v(e._s(t.row.get_invoice.head))])]),a("el-form-item",{attrs:{label:"发票类型"}},[a("span",[e._v(e._s(e.typeMap[t.row.get_invoice.type]))])]),a("el-form-item",{attrs:{label:"纳税人识别码"}},[a("span",[e._v(e._s(t.row.get_invoice.tax))])]),a("el-form-item",{attrs:{label:"发票内容"}},[a("span",[e._v(e._s(e.contentMap[t.row.get_invoice.content]))])]),a("el-form-item",{attrs:{label:"开户银行"}},[a("span",[e._v(e._s(t.row.get_invoice.bank))])]),a("el-form-item",{attrs:{label:"开户账号"}},[a("span",[e._v(e._s(t.row.get_invoice.account))])]),a("el-form-item",{attrs:{label:"场所地址"}},[a("span",[e._v(e._s(t.row.get_invoice.address))])]),a("el-form-item",{attrs:{label:"固定电话"}},[a("span",[e._v(e._s(t.row.get_invoice.phone))])]),a("el-form-item",{attrs:{label:"收票邮箱"}},[a("span",[e._v(e._s(t.row.get_invoice.email))])])],1)]}}],null,!0)}),a("el-table-column",{attrs:{label:"订单号",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"link",on:{click:function(a){return e.handleOrder(t.row.order_no)}}},[e._v(e._s(t.row.order_no))])]}}],null,!0)}),a("el-table-column",{attrs:{label:"订单金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("getNumber")(t.row.order_amount)))])]}}],null,!0)}),a("el-table-column",{attrs:{label:"开票金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("getNumber")(t.row.invoice_amount)))])]}}],null,!0)}),a("el-table-column",{attrs:{label:"开票税率"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("getNumber")(t.row.premium))+" %")])]}}],null,!0)}),a("el-table-column",{attrs:{label:"状态",prop:"status",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.statusMap[t.row.status+1].type,effect:"plain",size:"mini"}},[e._v(" "+e._s(e.statusMap[t.row.status+1].text)+" ")])]}}],null,!0)}),a("el-table-column",{attrs:{label:"创建日期",prop:"create_time",align:"center",width:"160",sortable:"custom"}}),a("el-table-column",{attrs:{label:"操作",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.auth.set&&!t.row.status?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.handleUpdate(t.$index)}}},[e._v("处理")]):e.auth.get?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.handleUpdate(t.$index)}}},[e._v("查看")]):e._e()]}}],null,!0)})],1):e._e()],1)})),1),a("el-dialog",{attrs:{title:(e.isUpdate?"处理":"查看")+"票据",visible:e.dialogVisible,"append-to-body":!0,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.dialogForm,rules:e.dialogRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"发票编号",prop:"number"}},[a("el-input",{attrs:{placeholder:"请输入发票编号",disabled:!e.isUpdate,clearable:!0},model:{value:e.dialogForm.number,callback:function(t){e.$set(e.dialogForm,"number",t)},expression:"dialogForm.number"}})],1),a("el-form-item",{attrs:{label:"发票备注",prop:"remark"}},[a("el-input",{attrs:{placeholder:"请输入发票备注",type:"textarea",autosize:{minRows:3},"show-word-limit":!0,disabled:!e.isUpdate,maxlength:"255"},model:{value:e.dialogForm.remark,callback:function(t){e.$set(e.dialogForm,"remark",t)},expression:"dialogForm.remark"}})],1),a("el-form-item",{attrs:{label:"发票状态",prop:"status"}},[a("el-radio-group",{attrs:{disabled:!e.isUpdate},model:{value:e.dialogForm.status,callback:function(t){e.$set(e.dialogForm,"status",t)},expression:"dialogForm.status"}},[a("el-radio",{attrs:{label:0}},[e._v("待开票")]),a("el-radio",{attrs:{label:1}},[e._v("已开票")]),a("el-radio",{attrs:{label:2}},[e._v("异常单")])],1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1===e.dialogForm.status,expression:"dialogForm.status === 1"}],attrs:{label:"发票附件",prop:"attachment"}},[e.dialogVisible?a("cs-upload",{attrs:{"file-list":e.uploadTemp,disabled:!e.isUpdate,"list-type":"text",type:"comp",accept:"*"},model:{value:e.dialogForm.attachment,callback:function(t){e.$set(e.dialogForm,"attachment",t)},expression:"dialogForm.attachment"}}):e._e()],1),1===e.dialogForm.status&&e.dialogForm.attachment.length&&e.isUpdate?a("el-form-item",{attrs:{label:"通知方式",prop:"send_email"}},[a("el-radio-group",{model:{value:e.dialogForm.send_email,callback:function(t){e.$set(e.dialogForm,"send_email",t)},expression:"dialogForm.send_email"}},[a("el-radio",{attrs:{label:1}},[e._v("系统邮件")]),a("el-radio",{attrs:{label:0}},[e._v("其他工具")])],1)],1):e._e()],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),e.auth.set&&e.isUpdate?a("el-button",{attrs:{type:"primary",loading:e.dialogLoading,size:"small"},on:{click:e.update}},[e._v("确定")]):e.auth.reset?a("el-button",{attrs:{type:"danger",loading:e.dialogLoading,size:"small"},on:{click:e.handleReset}},[e._v("重置")]):e._e()],1)],1)],1)},r=[],l=a("1da1"),o=a("5530"),s=(a("96cf"),a("d3b7"),a("3ca3"),a("ddb0"),a("159b"),a("b0c0"),a("a434"),a("ca00")),i=a("943f"),c={components:{csUpload:function(){return a.e("chunk-584c16a3").then(a.bind(null,"27d4"))}},props:{loading:{default:!1},tableData:{default:function(){return[]}}},data:function(){return{auth:{get:!1,set:!1,reset:!1},statusMap:{0:{text:"全部"},1:{text:"待开票",type:"info"},2:{text:"已开票",type:"success"},3:{text:"异常单",type:"danger"}},typeMap:{0:"个人/非企业增值税普通发票",1:"企业增值税普通发票",2:"企业增值税专用发票"},contentMap:{0:"明细",1:"类别"},tabPane:0,isUpdate:!1,currentTableData:[],uploadTemp:[],dialogForm:{},dialogVisible:!1,dialogLoading:!1,dialogRules:{number:[{max:32,message:"长度不能大于 32 个字符",trigger:"blur"}],status:[{required:!0,message:"至少选择一项",trigger:"change"}],send_email:[{required:!0,message:"请至少选择一个通知方式",trigger:"change"}]}}},watch:{tableData:{handler:function(e){this.currentTableData=e},immediate:!0}},filters:{getNumber:function(e){return s["a"].getNumber(e)}},mounted:function(){this._validationAuth()},methods:{_validationAuth:function(){this.auth.get=this.$permission("/order/service/invoice/get"),this.auth.set=this.$permission("/order/service/invoice/set"),this.auth.reset=this.$permission("/order/service/invoice/reset")},sortChange:function(e){var t=e.column,a=e.prop,n=e.order,r={order_type:void 0,order_field:void 0};t&&n&&(r.order_type="ascending"===n?"asc":"desc",r.order_field=a),this.$emit("sort",r)},handleOrder:function(e){this.$router.push({name:"order-admin-info",params:{order_no:e}})},handleUpdate:function(e){var t=this;this.currentIndex=e;var a=this.currentTableData[e];this.isUpdate=0===a.status,this.dialogForm=Object(o["a"])({},a),this.uploadTemp=this.dialogForm.attachment,this.$nextTick((function(){t.$refs.form&&t.$refs.form.clearValidate(),t.dialogLoading=!1,t.dialogVisible=!0}))},update:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.dialogLoading=!0;var a=e.currentIndex,n=[];1===e.dialogForm.status&&e.dialogForm.attachment.forEach((function(e){"success"===e.status&&e.response&&e.response.data.length>0&&n.push({name:e.response.data[0].name,url:e.response.data[0].url,type:e.response.data[0].type})})),Object(i["c"])(Object(o["a"])(Object(o["a"])({},e.dialogForm),{},{attachment:n})).then((function(t){"0"!==e.tabPane&&0!==e.dialogForm.status?(e.currentTableData.splice(a,1),e.currentTableData.length<=0&&e.$emit("refresh",!0)):e.$set(e.currentTableData,a,Object(o["a"])(Object(o["a"])({},e.currentTableData[a]),t.data)),e.dialogVisible=!1,e.$message.success("操作成功")})).catch((function(){e.dialogLoading=!1}))}}))},handleReset:function(){var e=this;this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.reset(e.currentIndex);case 2:case"end":return t.stop()}}),t)})))).catch((function(){}))},reset:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=t.currentTableData[e],t.dialogLoading=!0,Object(i["b"])(n.invoice_id).then((function(a){"0"===t.tabPane?t.$set(t.currentTableData,e,Object(o["a"])(Object(o["a"])({},n),a.data)):(t.currentTableData.splice(e,1),t.currentTableData.length<=0&&t.$emit("refresh",!0)),t.dialogVisible=!1,t.$message.success("操作成功")})).catch((function(){t.dialogLoading=!1}));case 3:case"end":return a.stop()}}),a)})))()}}},u=c,d=(a("388b"),a("2877")),m=Object(d["a"])(u,n,r,!1,null,"ba19bd32",null);t["default"]=m.exports}}]);