(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ba66d420"],{"27d4":function(e,t,a){"use strict";a.r(t);var i,o,l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-upload",{attrs:{action:e.uploadUrl,data:e.params,"file-list":e.fileList,"list-type":e.listType,multiple:e.multiple,"show-file-list":e.showFileList,drag:e.drag,accept:e.accept,limit:e.limit,"auto-upload":e.autoUpload,disabled:e.disabled,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"before-upload":e.handleBeforeUpload,"on-success":e.handleSuccess,"on-error":e.handleError,"on-exceed":e.handleExceed}},["picture-card"===e.listType?a("i",{staticClass:"el-icon-plus"}):a("el-button",{attrs:{size:"small",icon:"el-icon-upload2",disabled:e.disabled}},[e._v("点击上传")]),e.disabled?e._e():a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(e.uploadTip)+"大小不能超过 "+e._s(this.token["file_size"]))])],1),null!=e.storageId||e.disabled?e._e():a("el-cascader",{style:"width: "+e.fileWidth+"; padding-top: 10px;",attrs:{options:e.parentData,props:e.parentProps,filterable:""},model:{value:e.parentId,callback:function(t){e.parentId=t},expression:"parentId"}})],1)},s=[],n=(a("a9e3"),a("5530")),r=(a("d3b7"),a("25f0"),a("a434"),a("ac1f"),a("1276"),a("b0c0"),a("159b"),a("99af"),a("b64b"),a("ca00")),d=a("a320"),u=a("1213"),p={data:function(){return{moduleName:"",replaceId:0,updateToken:!0,token:{},params:{},uploadUrl:"",parentId:-1,parentData:[],parentProps:{value:"storage_id",label:"name",children:"children",checkStrictly:!0,emitPath:!1}}},methods:{getToken:function(){var e=this,t=Math.round(new Date/1e3)+100;return 0!==this.token.expires&&t>this.token.expires&&(this.updateToken=!0),new Promise((function(t){if(!e.updateToken)return t();e.params={},e.replaceId?Object(d["c"])(e.replaceId).then((function(a){e.token=a.data||{},e.uploadUrl=e.token.token.upload_url.upload_url,e.updateToken=!1,t()})):Object(d["b"])(e.moduleName).then((function(a){e.token=a.data||{},e.uploadUrl=e.token.token.upload_url.upload_url,e.updateToken=!1,t()}))}))},handleRemove:function(e,t){if("success"===e.status&&e.response){var a=e.response.data;if(a&&a[0].storage_id){var i=a[0].storage_id;Object(u["d"])(Array.isArray(i)?i:[i])}}this.$emit("upload",t)},handlePreview:function(e){var t=this;if("success"===e.status){var a={type:e.response?e.response.data[0].type:e.type,url:e.response?e.response.data[0].url:e.url};0!==a.type?this.$confirm("当前模式或资源不支持预览，是否新开窗口打开?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,type:"warning"}).then((function(){t.$open(a.url)})).catch((function(){})):this.$preview(a.url)}},handleBeforeUpload:function(e){var t=this;if(!this.token||!this.uploadUrl)return this.$message.error("上传组件初始化中或配置错误"),!1;var a=r["a"].stringToByte(this.token.file_size);if(a>0&&e.size>a)return this.$message.error("上传资源大小不能超过 ".concat(this.token.file_size)),!1;var i=e.name.toLowerCase().split(".").splice(-1).toString(),o=this.token.file_ext+","+this.token.image_ext;if(-1===o.indexOf(i))return this.$message.error("上传资源的文件后缀不允许上传"),!1;var l=this.token.token.upload_url.param;l.forEach((function(a){if("file"!==a.name&&(t.params[a.name]=Object.prototype.hasOwnProperty.call(t.token.token,a.name)?t.token.token[a.name]:a.default,!t.replaceId&&("x:filename"===a.name&&(t.params["x:filename"]=e.name),"x:parent_id"===a.name&&(t.params["x:parent_id"]=0,null!==t.storageId?t.params["x:parent_id"]=t.storageId:t.params["x:parent_id"]=t.parentId<=0?0:t.parentId),"key"===a.name))){var o=r["a"].guid();t.params.key="".concat(t.token.token.dir).concat(o,".").concat(i)}})),"careyshop"===this.token.token.upload_url.module&&(this.params["x:is_actual"]=Number(this.isActual),this.params.token=r["a"].cookies.get("token"),this.params.appkey=this.$baseConfig.APP_KEY,this.params.timestamp=Math.round(new Date/1e3)+100,this.params.format="json",this.params.method="add.upload.list",this.params.sign=r["a"].getSign(Object(n["a"])({},this.params))),this.autoUpload&&(this.loading=!0)},handleSuccess:function(e,t,a){if(200===e.status&&e.data)return 200!==e.data[0].status?void this.handleError(e.data[0].message,t,a):(this.$emit("upload",a),void this.handleChange(a));this.handleError(e.message,t,a)},handleError:function(e,t,a){this.$message.error("资源：".concat(t.name," 上传失败")),r["a"].log.danger("资源上传失败："+(e||t.response));for(var i=a.length-1;i>=0;i--)if(t===a[i]){a.splice(i,1),this.$emit("upload",a);break}this.handleChange(a)},handleExceed:function(e,t){if(t.length>=this.limit)this.$message.warning("最多只能上传 ".concat(this.limit," 个文件"));else if(e.length+t.length>this.limit){var a=this.limit-t.length;this.$message.warning("上传数量超出限制，最多还能选择 ".concat(a," 个文件"))}},handleChange:function(e){this.autoUpload&&Object.keys(e).every((function(t){return"success"===e[t].status}))&&(this.loading=!1)},getDirectory:function(){var e=this;null!==this.storageId||this.parentData.length>0||Object(u["f"])().then((function(t){e.parentData=r["a"].formatDataToTree(t.data.list,"storage_id"),e.parentData.unshift({storage_id:-1,parent_id:0,name:"根目录"}),e.parentId=t.data.default||-1}))}}},c={name:"cs-upload-comp",mixins:[p],props:{uploadTip:{type:String,required:!1,default:"请选择资源进行上传，"},listType:{type:String,required:!1,default:"picture-card"},multiple:{type:Boolean,required:!1,default:!0},showFileList:{type:Boolean,required:!1,default:!0},drag:{type:Boolean,required:!1,default:!1},accept:{type:String,required:!1,default:"image/*"},limit:{type:Number,required:!1,default:0},autoUpload:{type:Boolean,required:!1,default:!0},fileList:{type:Array,required:!1,default:function(){return[]}},storageId:{type:Number,required:!1,default:null},isActual:{type:Boolean,required:!1,default:!1},fileWidth:{type:String,required:!1,default:"100%"},disabled:{type:Boolean,required:!1,default:!1}},mounted:function(){this.disabled||(this.getDirectory(),this.getToken())}},h=c,f=a("2877"),m=Object(f["a"])(h,l,s,!1,null,null,null),g=m.exports,y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"upload-control",on:{click:function(t){e.visible=!0}}},[e._t("control"),a("el-dialog",{attrs:{width:"400px",visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visible=t},open:e.handleOpen,close:e.handleClose}},[a("el-upload",{ref:"upload",attrs:{"list-type":e.listType,action:e.uploadUrl,data:e.params,multiple:e.multiple,"show-file-list":e.showFileList,drag:e.drag,accept:e.accept,limit:e.limit,"auto-upload":e.autoUpload,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"before-upload":e.handleBeforeUpload,"on-success":e.handleSuccess,"on-error":e.handleError,"on-exceed":e.handleExceed}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将资源拖到此处，或"),a("em",[e._v("点击上传")])]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(e.uploadTip)+"大小不能超过 "+e._s(this.token["file_size"]))])]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"cs-fl"},[null==e.storageId?a("el-cascader",{attrs:{options:e.parentData,props:e.parentProps,size:"small",filterable:""},model:{value:e.parentId,callback:function(t){e.parentId=t},expression:"parentId"}}):e._e()],1),a("el-button",{attrs:{size:"small"},on:{click:e.handleClose}},[e._v("取消")]),a("el-button",{attrs:{loading:e.loading,type:"primary",size:"small"},on:{click:e.handleConfirm}},[e._v("确定")])],1)],1)],2)},v=[],b={name:"cs-upload-slot",mixins:[p],props:{uploadTip:{type:String,required:!1,default:"请选择资源进行(支持拖拽)上传，"},listType:{type:String,required:!1,default:"text"},multiple:{type:Boolean,required:!1,default:!0},showFileList:{type:Boolean,required:!1,default:!0},drag:{type:Boolean,required:!1,default:!0},accept:{type:String,required:!1,default:"*/*"},limit:{type:Number,required:!1,default:0},autoUpload:{type:Boolean,required:!1,default:!0},storageId:{type:Number,required:!1,default:null},isActual:{type:Boolean,required:!1,default:!1}},data:function(){return{visible:!1,loading:!1}},methods:{handleOpen:function(){this.getDirectory(),this.getToken()},handleClose:function(){this.replaceId>0&&(this.updateToken=!0),this.replaceId=0,this.visible=!1,this.loading=!1,this.$refs.upload&&this.$refs.upload.clearFiles()},handleConfirm:function(){this.$emit("confirm"),this.handleClose()}}},k=b,_=(a("be90"),Object(f["a"])(k,y,v,!1,null,"571b7fd1",null)),x=_.exports,$={name:"cs-upload",props:{value:{type:Array,required:!1,default:function(){return[]}},confirm:{type:Function},type:{type:String,required:!1,default:"comp"}},data:function(){return{fileList:[],source:""}},computed:{component:function(){return"comp"===this.type?g:"slot"===this.type?x:"div"}},render:function(e){var t=this,a=[e("div",this.$slots.default)];return this.$slots.control&&a.push(e("div",{slot:"control"},[this.$slots.control])),e("div",{},[e(this.component,{ref:"upload",props:this.$attrs,on:{upload:function(e){"comp"===t.type&&t.$emit("input",e),"slot"===t.type&&(t.fileList=e)},confirm:function(){"slot"===t.type&&(t.$emit("confirm",t.fileList,t.source),t.fileList=[])}}},a)])},methods:{handleUpload:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";"slot"===this.type&&(this.$refs.upload.visible=!0),this.source=e},setReplaceId:function(e){this.$refs.upload.replaceId=e,this.$refs.upload.updateToken=!0},setModuleName:function(e){this.$refs.upload.moduleName=e,this.$refs.upload.updateToken=!0}}},w=$,q=Object(f["a"])(w,i,o,!1,null,null,null);t["default"]=q.exports},"8b9e":function(e,t,a){},be90:function(e,t,a){"use strict";a("8b9e")}}]);